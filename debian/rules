#!/usr/bin/make -f

export PYBUILD_NAME=shibuya

%:
	dh $@ --with python3 --buildsystem=pybuild

override_dh_auto_build:
	# Check if nodejs is available and version >= 18
	if which node > /dev/null && [ $$(node -v | cut -d. -f1 | cut -dv -f2) -ge 18 ]; then \
		echo "Node.js version $$(node -v) detected. Building static assets..."; \
		cd static && npm install && npm run build; \
	else \
		echo "Node.js version $$(node -v) is too old or missing (need >= 18). Skipping static asset build and using pre-built files."; \
	fi
	dh_auto_build

override_dh_auto_clean:
	dh_auto_clean
	rm -rf static/node_modules
	# Do not delete built assets to support builds on older systems

